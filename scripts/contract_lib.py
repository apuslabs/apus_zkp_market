import json
import sys
import random
import time

import web3
import argparse
from scripts.config import role, env
from scripts.conn import *

none_address = '0x0000000000000000000000000000000000000000'


def gen_client_config(owner, client_id, url, max_instance, min_fee):
    return {
        'owner': owner,
        'id': client_id,  # 这是一个示例ID
        'url': url,  # 这是一个示例URL
        'minFee': min_fee,
        'maxZkEvmInstance': max_instance,
        'curInstance': 0,  # 这是一个示例的当前实例数
        'stat': 0
    }


class ContractLib:

    def join_market(self, prover, client_config):
        tx_hash = transaction(prover, market_contract.functions.joinMarket(client_config))
        return tx_hash

    def getLowestN(self):
        return market_contract.functions.getLowestN().call()

    def getProverConfig(self, addr, cid):
        return market_contract.functions.getProverConfig(addr, cid).call()

    def post_task(self, user, uniq_id):
        return transaction(user, apus_task_contract.functions.postTask(0, uniq_id, b"hello world! input", int(time.time()) + 90 * 60, dict(token=none_address, amount=10)))

    def dispatchTaskToClient(self, user, block_id):
        tx_hash2 = transaction(user, apus_task_contract.functions.dispatchTaskToClient(block_id))
        return tx_hash2

    def get_task(self, block_id):
        return apus_task_contract.functions.getTask(0, block_id).call()

    def get_task_by_index(self, index):
        return apus_task_contract.functions.tasks(index).call()

    def submit_task(self, user, task_id):
        tx_hash2 = transaction(user, apus_task_contract.functions.submitTask(0, task_id, b"""\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 \xd7\xb9\xc4d\xab\x86\xc8\xcezk\xe0-\x8d\x1b\x03\x82\x8b\x1a\xccUp\x89l\xcf\x94N.g}*\xe4o\xc8g\t}\xe1J%\xb5gqE@\xb4\x89\x83\xdb\xa2%\x1a%\xf3\xdc\xee#\xd9Q\x8f\x7f\xe6\xd3\xebp\xf2\xd4\x85a\xc0\xa1\xa0\xa8\xc8\xca5\x9f\x99\xaf\x94\x0b\xf6.\x96\xdc#\x15\xd9\x81\x84\r*E\xbaz\xa5\x04\xf8\x06\xf9\xd4\xc6<=DK\xc1\xde\xb5y\xff\x11\x8e?@R\xc8\x0b\xe2\x0bM\xbd,\xd8a\xbc\xdaI\xe7\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x86<\x9b\x81Y\xb3\xf9V\x87\xa6\x00\xb1\xb2\x1a\xe1Ya\x8b1\xb1\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00[\xce3\xd4\xd5\xbbC\x8d\xad\xa7\xde\x89/\xf6D\\\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\x99\xce\xc8\xbcz\x8e\r\x08\xe0\xe7\\<\x85\x8dL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x06\xc2\x93\x83UYA/\xd3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xaf\xf7\xe8l\xb6\xcc\x10u\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\t\x84\xed\xd101\x1d\x11$\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x8c\xa5\xfe\x96\x07\xc1\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0cJ9\xbc\x08\xf1G$/\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x18\xcb\t\x94a1#\xb8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\xc4\xa1\xf0\xc4\x8e\r\xb9\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x0f\x8a~\x99\x07\xc8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0ch\xd0\xeew\xf6\xa9\xe3\x98\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x85\xe1\x86^\xbc\xa4\xd9\xa4\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x8c\x1bx\xb2\x87\xc7\xbbF\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x87\xa2\xfe\x8a\xc9\x16\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b:\xe9\x89)\xe2\\\xca\x0e\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x837\xcc\x832`\xc6A\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xaah\x1e\xc0w\xbcL!\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xd7F$\xcc\x1c\x82\x0fA\xe7\xd3F\xee\xea\xba\xbf\x8b\x8f\x88e\x84\xc8\xa2\xbf\x8eD\x12\x04\x97\xb4R\x9bx\x87\x1a\x9b\xd0\x06\xec%Q\xbc\x02P\xa3I\x85uL\xcee(\xa5q\x0c\x07\'\xbe\x97#P\xf8\xa8$\xa0@B\xe9\x14\xb5\x91-u\xdb\x02{\xde\x18;\xbb\x8c\x0f\xbe\x8bl(\\)wy3\x00\xee85!\xe3\xe0\t<3\xdb>\x0b\xdcJ\x01\x14g\x14N\xa0\x82d5%\x81\x1c\x157\xc5-\xea)e0\x82>\xae\xac>!La\x9b >!]\xf5\x9aw\x14/\x0e\xda\x06\x11\xe2\t\xf7~\'\xa9\xdb!.\xf0\xa7\xfa{\x11J[(\t\t\x019\xea"\x92\xfd\x1b\x11\xcaT\xcb\x7fH<\x8fs\x1e>@\xb96\xa6\x81q\x1d!*M~Xwn$\xef\rC\xf6\x0b\xe2:wn\xaeCs+\x85"\xb9\xd90\xb8\xdbG2\xec\x1cN\xcb\xe5\xee\xc6Z\xdd$-\x9cl\xf3%\xf2\xa6\xa3\x7f\xf5\t\xc4\xf3\'C\xa2\x7f\x11K?2U+\x1c\x0b\xc6\xb5\xe6\x89E\xdf\x08\xd6\x85Ld:l\xe7e\xdc\xa1\x0c4#qEy\xf9\x8f\xab\xff\xa9\xa9\xd92M\xd0\xd4\xcc\xcb\xc5\xd1)\xf7\xd6\x03\x88\xae\xf5\xf4\x043] \xbe\xf4\x10\x86\xbc\x11\x99\x85e\xeb\xf2$\xd6\x81[:\x19ShB\ta\xc5&\x05\x1b\xc2\x95\xe4\xb5\x8a$>g,a\xe7\x15kG\xee\xc1\xe2\x9bV\xde\xa3\xaa\xa9\xb2.\xa4\x01\xa9Z\x97a\x83\xcb\x08\xfb{o\xad\x7f\xc7\x89\x05\x86\x86\x15\xe4\xcf\xe1i\x86\xfd\xd8\x1c\x829\xc9\xcd*\x1e3G\xac\xfeR\x10\xe6i\xeb\x14AW\xd8\xc2\xe3\xac7XBj\x00O\xfbqH\xa2\x87\x9f\xd7\xc1\xd2/~\xf3\xe6\xe7@T\x13\xe7\x8b\xbe\x7f\x8a\x8a\xb7\xb1y\x9e\xd2\xb8\x98\x0c\x14\xbd\xd2\x8a\x96Ss\x92\xb2N\x06Hg$}P\x17)]\x1ac\xc8\n\x0f\r\xdc\xc8C\\\x99\xa1\xc58\x7f\xff\xbb\x1d\xac\x91\x9fJ\x0c"\xc6\xf14\xd3\xc2\xedEI\x1d\xd0f\x95?\xdbB\xe4\xdb\x13\xdf \xc1g$R%T\xf0S\xccf\xb7*V\x14O4\x8a\xb2\x0f\xa1\x89\t<\xd0\xed\xa4\xd6\x9d\xa9\x05g\x88\x01\xe4\'\xd6\x85\x1a\xb5%S\\6\x03\x97Q;L\xbc\xdd\xd9\x03F\x8a\xe8F\x8b\x02w\xa9\xb9y\xcfm\xef\x95L\xca\x8a\x11\xa5\x88\xdc3\xfe\'\xb0\xb13\xc6s\xfa\xc7oe\x90\xa9pI\xe9\x94\xaf\x90-\xf4K\x1d_\xb0\xa0\xcc\x7f\xf7Y\x00\xca\x84!\x01\x81\xa6\xc6\xddC\x06\x0c}\xbc^SzY\xbd[h?y\xbfP\xef\x0c\x97tb\xedL}\x14B\x1d\xb1\x9c\xa7\x81\xaf\x1d@$C\x00\xb7Q\xbf\x11\xeb\x80\xe0\x07\xbaR\xe2\xac\xd8\xfb\nQ\xba\x9b\x97E\xec\x05\xfa\xa8\x14\xcc\xacG`C\xfc\xa8!\xb8\xba\x87\xc1p\xcf\xba\xdf\x838\x9d\xca\x7fP\x10\x98\xa71\xef%\x17\xaf\x15\xc9\xd3\x94\xd1)\xe7\x80\x8d\xdf\xaf\xd2\xd3\xe2\x0c\xacT\xa2+\xe8\x145\xe4\x95\x08<\x93pPQ\x04kP\x02\x0c\xbeg\x98\rka\x96\xe8E\x0c\x9f\xab\x18\x14\xbc\x1a\x93L{\xb1/j\x81\xd9\xbbRw\x05\xdf\xd9q\xa4\xf8|\xb2\x82k\x1e\x14\xbfq\xef\xe9;9\x1a\xeb\x92\xfe\xd7\xb3\xac\xb1\xd6\xae\xb0\xbeVX#;$\x86\x1eT8\x90\xf2\xc9 o\xa3p8\xe5\x83\xd8\xfd\xc0\xd7J\xfe\xed\x84k\x0fa2K\xdc\'\x19\xe6\x1b+\nK\x05G\xee\x87\xb52:*\x91=+$\xae\xd3\xba\xf3\xb2!\xed\x8a\xbe\xc7\xa6\xe8\xb9\xbf [b\xf7\xe5\xce\x03g\x88\x9f\xbc\xcd\x9d\x13!\x8c\xa2T\x891\xac<\xf8\xfa):\n\xe3ep\xf4\x16+\xe2\xa9\xb9}\xb3\xcd\xae\x15\xa7f-d\x03\x0e!\x9d\x0f2J\x80\xdaZR\xbc\x9e\xa9(\x14\xc3\x81\xbf\x0e\xb9q7CV\x97\x04\x15\xcev\xf3=\r\xcd@\xdf\xa8Y?\xc8\xb9\x15sj\x14\x7f\xae\xdau\x15\x88\x15t\xc3\x93_\xf9\x95\xa2[h\xd1\x7fR-\x14\xa1\x7f%\xe2\x01\xf4\xa8E\r\x8by3\xb9\xceS\xf9\xa6\x03g\x95\xb9\xbe\x9d\x1aR\xff\x89n;\xa8\xf5-\x86\xbf\xd8qnVe\x0e\x05\x1b\xe1,s\xb9\x8c\xa1\x89\x04\xdf\r\xe3\x8d\x96\x97\xf9\x9e\xf2z9z\xc7|>\x8f\x17n\xe2\x12\xd9\xa6\x9a\xc7\x94\xd2Z5$\x0e\x80\x0c\xe8t\x18\x8e)z\xab\xc3sc\t\xf1\x0fI\xd5\xf0\xb8\xd4\xc0cpeDf\xed\xa1\xf9\x9e\xbf\xd0\x96\x0e\x98*\x00\x89\xdbe\xc1\xaa\x8c\xbc&\xac\x10\xc3\x81z\r\x19\xcd\x06N\xdd\xa4/\x1d$-tR8\xde\t\x84\xc0B\xd87\xb5\xc5WTSw\xe4\xee\xf5&\xf1g\x1a\xb2\\.\x1d\xf6\xa1\x9d\xe1\x88\xaaQ\xfc\xe7+y\xb8n#\x88\xf3\x9f\',FdO\'Y\xef\x0f\xecC\xae\x14\xedQRDt\xd5EW.\xb0\xe0\n^\x17\x9e\x15/#P\xbc\x93\x85\x92@\xac\x1a\xce_\xeez\xd4\x86}\xa1\xef\xe2\x95\x9c\xb3\xd7M\xec\x85\'\xab\x0c\xe8"\x8c\xe8\xd2\xb1\xea\xb0\x12C\xab\xb8\xce$ie}\xd8\xc6.S\xdf\xc8\xa4_\xf6\x0bmA\'\x11\xaa&\xda~*z\xf1l\x0b\x0f\x0c#4\x19+\xa7\xf1\xe1\xc6\xe2\x8b\x86\x7f\xee\xb5U\xbd\x90cW\x14\xe1\xf1\x1b\xf70E\'\x11\x8a\r\x05\x147/\x1d<\xb3p\x9bw+\x16\x8dPLM\xab\x0f\xdb\x02r.6o\xe7\xc4\xf1\x83\x8a\x1bR\xf0p\x87\xc4<\xc4\x8d\x0eR\x1dS\x8b\x96\x01\x19m\x0b\xafN(\x1e\x91 \xa5c\xb0M\xae\xaa.\xd7\xd2\xe2\xa4&\x169\xaf\xf9\x1a\x87)\xe7\xdb\x17\xb6\x12\xbb\x84\xe64\xa7\xbe\x14\x17<\x8ak\xbb+\xf5\x18\xa6;\xe5j\x19\xed\xed\xc8\x93f\xee\xf3\xd8S\\\xd2\xb6\x13\xc5\xde:\xf8\xee\xe3\x1ei8\x12\x95\xa1={\xf3\xc1\x95\xdd:\xd3?\xe1\xc7\xc8~\x9cr\xac5\xc7\xa9\xf9+\x85)\xfc!)\x0f\xa4\x94]\x1e\x92\xfe\xe3&\xe4\x983\x14\x16\xd3\xee\x8f\xbb\xdb\xc5\xc0\xb5\x1eV\xb8\xea\xc0&\xf3\x85\xf2\x8b)\xb1\x8d\x9d/P\xe08gK[\x9d\xf3\x96%\xa5\x17\'\x8d\x05l\x7fk\x0b\xf3:\xe3`Y\x83M\x98#p\x16\x87\xe8\x83\xda:\x9d\x96\x9cE\xdexhr}\x19o\x9b.4L\nlv\xe4\'\xf8S\xb1\xbe\x14\x927:\x88n\xd5\x146\x82J\xd0\x8b\xcb\xf2\xa5\x0fw\xa1+\xbcT\x08\xb4$\xc0\xe6Vfi9\x10\x0bs\xc3\x19\xdcpO\xb1\x02\xe2\xd1\x96\xd0\xf9\xde\x85C\xfd\xc4mW\xbc9B\xe4q\x14i6\xb9\xf8\x1e\x1d\x83\x9a\xfa\x1bK\xc6\x92\xb9\x01Z\x96\xa0\xb4\x0f\x1a\xc7\x9b<q\xa8\x11\xe3\xf2\x0eZz\xe0\xb7\xce\xc1V\x02\xfe\x98E\xe2Jl*\x99\xc8\xce\xfb\x80\xd7|\\\x96\xee?\n\xa0Z\xab~\xad\x9d\xdc\xb0\x97\xc5\xd0>*\xd6\xb7\x99\x19\xe6\xeffv\xb0\x9a\xca\x1d\xf3\xf1\x88\xd1\x8c\x97FW\x97\xe6A\xc8\xf3\xd5\x1c\xc2]\x98A$\xd6\xb7\xb3\xb829\x82x\xefz\xf2>j;\x014\xd4\xbe\x8c\xd0\xea<\xba4I\xaf\xd1\xd7}\xaak\x04J\xed\x0f\xe2\xa1\xe8\xa7y\x1a\xc3\xc4\xe3\xf2\xf0\xb10\xb0C\'\x9d\xd8\xe9\xa4\x8f\x8fwL\xfa\x0c\x0c\xfe\'\xd6u\xde\xafp\xf5\xf0\xb7\xf8\xca\x9c5Ek\xcdPxf,\x80\x84\xb0\xc6\xb9\xe6\x98\xec<8.L#-\xea"o\x92\xcd\xec\xbf\xc5r\xb3\xee\xeaBA\xc8\xbc"\xe6\x0b\xc2~\xd7o\x94\xa2)\xa1o?s\x12\x94\x19\xbf\xe9e\tp\xef~F\xd5\xc1N\xa9\xf2t\xe9\xd48\xbf_"4\x17N\xe37[-3w$\r\x1e\xdb\x1e\rf)\xfc\xefP\xff}\xb4\xc81\xa9\xcb\xae&y\xe2O[\xa2\xecG\xfd\x91Y\x18\x92\x11C\xb6\xf0y2\xad\xfe\xc7\xd3\x19\xaf\xfaQJ\x93\x1abz\xa3*\x98\xba\x88\xd9h\x18k\x94\x04\x8d\x7f\x0b*\x15\x81V\xba\xdd\x83#O\xf1\xdc\x08\xff+Nb\xe3\xb4\xe3\x1e!\x86G[KYh:H\xd7\x93(;\x0fK\xc6A\x87M\xb2\x9c0\x1bSt(\x90\xd4Yu\x9d\xffX\xfe\x19\x9f\xc7\xde\xb2\n<\x8e\xd3\x05\xabJ(\xf42\x97.K\x8dI\xe9\x05\x99\xfb\xda\xf7lD\xdc\xb8w\xf8\xe4\x8c:\xd4\x91r#\x10\x8a\x17t\x15\x91\x83S\xa4\xdc\xbf\xa1\xf3\x03\x1c\x80\xc6S.a?\r\xab\x99@\x89aT\x9c\xb0\x13\x86I*\x16\x80\xfe\xf5\x11,\x0f4o\xe6\xf52\xb0\nw\xdd2\x02\xcd\nB\x84\x02\xc3\n1HY\xae\xdbqy\x02\x84\x12\xc7A\xc5\x04\xa0?\xe0:x\xa3\xb8\x81\xe1^p\x84\x8bO,\x96\xf1\x1cA\xabP\xa4\x9bcJ\x16>\xd3@\x87|\x08C\x10\xef\x9e\xc3\xd7\xa9\xc5O\x06z- \xf5\xbaU\xfe\xe8;P\xbe\xbf\n\xcd\xb9&\xb8O\xc4\x81\x01}7\xc9\xc2&\'.\x85\x02\xbdO|\xa7\xe6?\x9e\xb4\xfe\xb9@\t\xd7\xa4\xc2\xb4\x10\x1a.mQ\xec\xe4\xc9O=\xb8Q\xe8\x97I0\xe4H\xe2\x87X\x97(L\x91\xff\xa1\xbd\xae\xf1\xb3OS\x06\xf1\xb7.\xe2\xb3y\x98\xcc \x04"\x18\xae\x8fd\x04\x90\xf5\x15\xc2\xcd\x94\xd4\xf8\xce\xf7\x05\x01XD\xd2\x1a`\xb9\r\xe5\xc0\x18\xf2\x92\xe0\x9e\xfd\xda\x16\xc8\xd9\x1a@\x0e\x03\x9d\xab\x17un\xf0!\xb7\xf0Iu\xcf\r5\xf0j\xd2k\xc9\xd9i\xf6mT\xb9G\xab\xe6a\xed\xf3\xc7\xa8\xbb\xe9\xc1~B=\xd4\xef\xc6\xfc5\x0c\x07\xd8w\xe9\xaa\xaa\x88\xd0\xd6\x82\xdf|\x84A\x16QG\xabh\xa3g9\x8d\x8d\xf1J\xcf\xd3\xf57\'\x02\x84SS\x88\x0c\xa6\xa91\x90\xa4\xecK\xfas\xd8,\xc3\x82\xeb\\\xa8q\x92\x04\x12V\xd9;\xac\x90>*\x83<\x94\xfd\x80`\xc9\xb9,\x91\xf8L-\xe1\xe9R-`\xf8q2\xec\x08\xd1%\x90\xb5\xe5\xa1s~\x07=\x81\xef\xd5\xe9\xff~n\xb9\xfb\xd2\x98sL\xeb4\x1a\xd1\x18\x81\xb3!yao\x19\x1d\x8f\xec\x15\xdb\x13/n\xe2\x9aOI\xd2\xb2\x92[\xd6\xf5\x91\x17N\x86d\xe2\xfe-\x1c\x99\xd0\xc6caa};5\xcb\x0f\xf9\x1f\x16$o\xa3\xcb\xbf\xc7LHT"\xb7@J\xc4C6\xdd8\xea\xc9\x9cM\xd0\x86\xaf99\xbd\x16\xd7\xe6o\xef(\x0e\xb6\xac\xe6\xacZ/~>\x06\xe7\xabO\xa5\x8e\xb6\x88E\x08\xa9!\x99\x80\xdf\xd3\x86\x16\xafZ?\x1d\x17^\xc0\x02\x1a\xbd\x96\xcaA\xe6\x83\xac\xefp_lu\xe6\xc3\xff\\1\xe1\x80\x1f\xf6\x16(*\xd3*\xc5\xe7L\xe0\x8f\xb3\xde\xddr\x1d\xb8*[\xda\xe7Rf\x95\xe5\xff\xb6<\x05\x91m.\x07\xbf$=\x91xc\xb7F\xf4\xb2\xa1\xbf\x0f\x81\xcc\x89\x14\xaf\xbc9\xbd^\xef\x8eV#v\x1d\\?6X\x97\x05\xa2\x8dD\xf0\xc7:3T\xdc\xb4-\xaf\xb3\xc0Y_,\xe4\xb6\x93CJ\x16 \xddJr9-\x1b\xec/\xfd\x9a\x8c\x04eA\xbaa+j\xaf\x9fV\xc6\xcaR\xd4\xe7\x7fO\x8dy":\xa8\x85\xba\x9063\xb1*\xe2z\xc6\xbbk\\\x95\x07\x95\x81\x9b\x8c\x9d\xdd\xaf\x93)*9h\n\xea\xf3\x89\x9b\xd6#$.\xf5\xa0\x0e;l\xd1\x1d\x85\xcc\x9d\x0eQIM1G)\xacE\xe1\x05\xb8\xdbx/AT\xa4\x9f\xf7\xab{uM\x11y\x00\xd6"(|\x06\xd9\xe1\xd9\x03\xf4\x8b\x08;\roN}e\xe6\x0ce\xa3H\x9a\x10\xd6\xafh\xb6&7P\xf4\xb9/W\xfd\xc2B\x91\x13n\x83\xa4\xc7D\xaa\xa2\xe5\x98O\xb7\x13\xc0\xaa\x81H\xa3\x1b\xf9K \xf5v\xbe\x10]\x99\xff\x15\x88\x81~%\x06\x1f\xcd\xdds\xf7\xea\xee\xf1\xd2\xdd5_y\x85\x17\xf3l\x14\x00\xf2\x91\xe6eR\x99\xb9\xa8\x87\xc2\xc3\x81\x8fKX[g\x07\x94\xb2K~\xf3\x9e \x1f\x96\xa62\x15\xd2\r0sS\\\x8e(\xd7\xc5c\x07Y\x93\xfc\xe3jR\x15\xc3\xc1\xfc\x12\xed%\xcc\x8f\x04\x16)\xe2\x9dt\x0e\xe3\xc0\x9br\xe4a\xd4*\xdc\xc1\xebNow\x9f\x97\xa6\xa3\x80a\x0e*J\xbb\xd9P\xdf9\x96\xf2\xb9%92\xc6W\xcd?\xf0\x8e2NE\x08\xbaE\x94S\x88\x94F\x18\x89\x0b~xx\xc4\xb1G+5f\r\'\xfbp\xb2\x08\x03\xf4\xa9\xf4\xf5\xbf\\"\x1d:\x05U\xa7I\xd9\xd1\x03\xc4\xe2B]\x0clIIx\x1az\x1e\x97<\xc3:5\x9e\x1cm\xf3\xc3\x05s#\x86\x1b\xec\x98sg\x83\xb0\xdc\xd2\xcei\xaa\x98\x05\xfd)\x9c\x95Z\x16\xd3`\xf1Qr2V\x8e\x99\xcc\xe3\x1e\xc8\xf7\xc5\xd0\xe6\x0e%\xb7\x1dG=\xa1e/\x88\x1c\xdd\xec_\n\xbd\xb7\xfb\x19\r\\\x96\x06\xa35|\xf8\xf3\xe0\x8e\x9f\xe3{\xe9.^N:cu\x8bp\x14$\x8d\x1cm\x0f\xb8\xa9\x06\xf5\x89\x8ej\xf2q\x02\x81;\xd9\xafW\xf7r\xf8*\x9f\xc2N\xeb\xac\x93\x87\x02\x0f\xa5O\xa6W\xa4SS\x00\xd7\xd8\xd0:\xef\x9ea\xcc\xcc\xa6\xfca\xe9}\xd8\x0c\xda\xa7\x1cb\xa20\t\x97\x82\x80\x82\xc2prBc\xf0G\r$@\xedw\x8deD\x14o"V\xa3\xa8 \xf1\xfdU\xeb\x8e\x16\xaa\x8e\xfa_\x94\xf13x\xb2\x02Q\xe6\xdeqf|\xec\xf8\xc6\xed\xe0\xafS\xe6\xe6h\xf0x\\% )/=\x96\xe5\xe4\x10h\xb0\x85C\x9fH\rinA\x96\xdb\x81B\xe9f\x81\xad\xaaS\x99\xb7}\xa9\xee\x0b\xfa\xeb<.\xf3\x93\xa5\xbf\xbf\xbb\xbc\xfe\x9d\x0f\x9d\xc5r\xc4\x8b%\x1fb\x01Dk\xb3zo\xaf\x1fi\x02N\x96f\xcdG\\\xf8U\x18\xf2\x98&uZ\r\x822\xd1\x9b6\xccL\xf5\x80\xca\x12i]\x1ak8\x04\xdeL\xdb\xfao?\xec`\x17\xa8\xec\xd8GT\xbd\xd1\xa9\xf5\x89o\x0fIm\x91T&\xbd\xea\xd4u\x8b\x0b\xf5\xa6\xb5\xe0B\nGH\xea\xad\xafr\xf6\xae/~*X\xb2\xe4t\xfc\x01:~\x88\x9b\x0eQ\xd7\xd10R.\xf9\xe7_\xe1\xdc_\x0eD\xe3\xf1\xbc\xa7kp\xbaF\xc3B5\t\x91\xdaG*\xa3\xda\xcb\xc3\xe0.&\xd4\xf6\xb8\xfa\x9f\xd29\xfa}\x06\xbe\x1a\xb7\xb8\xcb\xa6)\xabG\xd7\xd1\xb0\xdd\xae\x01\x07\xae\x15k\xe8 \x13\x00T\xf2dk\x9c{\xb1\xcam\x0f\x10\xd0\xb1\x7f_7e\xbaN%\xd0\xe6\xfe\x87?\xdd\xf2s\xc8\'?\xaa\xe7l\x16\x1f\x0e\xc3o\xc9\x03\xd7\x85\x1f\xce3\x80\xeb\xf4\xf9\xd2\x1b\x843\xcf\x01\xb5\x1f\x8c\xd1\x1b\x01I~\x05S\xf6\x12\x869d\x9a\x8c\x8a\xe8\x8f-s\x91\x08\xfc\x9a\xb7\xe1y\xa8|\xd4\x1c\xaa\xaa4\x8b \x1f\xce\xd2\r\x16\xc5\xe3\xb9\xa3\t\xee\xd2\xc0\xa4\x85~k\xb8\xc9\xdbB\x945\xc4\xa7\x80\x8e\x01\x1d\'\xe1)\x84\xc6\xb7)\x93\x00\xb8\x1c2\xf9\xebw\xf7\xb6\xe4\x88\xcf?,\x81\xa6)\xff\x87\xcb\x07\r)O\xdd\xa1 \x03\xf9\xef\x08\xc7W\x9d\xa3\xbbT\xbd6]c\xd7)\x83x.\x85Pxv\x8d~\x08\xa4 Uo\x0f\x10=\xb4y<Q\xe2D\x12\xbf\xed\x8f\xee\x1a%\xb6\x0bT\xd0\xcen\x10\x08\xe3\x8aJ\xea\xeb}\xcc\x1aO\x08A\xa2^\xde\xa2`\x87\xaa\xc7\xdf\'\xbcx\x8a\xe4@7\x1e\x815\x0e\xa2\x1d\xad\xafYm\xd37\xdeZ\x17\x120\xd1k\x89(\xec\xad\x1ce\xa8\xb4\xa5\x93J\x9a\xdf\xf3\x19\xe6|\x01!\xb9\xa4f\x9b\x0c\x9b\x08+\r\xeb\x0e\xb7C\xe3W`_b\x99\x01_oP\x9f\x91jW;D^r;\x85U\x95W\xe18`\xde\x134Y*\x7f\x07\x00\x83\x0f\xd2\xdc\x1fKM>\x93\xb0(\xd7\x13\xd6t\xd2q#\x19\x17\xd4\xb3\xba5f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"""))
        return tx_hash2

    def market_dispatch(self, user, addr, cid):
        return transaction(user, market_contract.functions.dispatchTaskToClient(addr, cid))

    def has_resource(self):
        return apus_task_contract.functions.hasResource().call()



connector = ContractLib()


def creat_client_2():
    # provider 0xC2600C80Beb521CC4E2f1b40B9D169c46E391390
    client_config = gen_client_config(role.provider.public_key, 22, 'http://ec2-18-209-35-10.compute-1.amazonaws.com', 1, 10)

    print("-" * 10, "加入market client", "-" * 10)
    tx = connector.join_market(role.provider, client_config)
    print(tx['status'])

def create_client():
    # provider 0xC2600C80Beb521CC4E2f1b40B9D169c46E391390
    client_config = gen_client_config(role.provider.public_key, 11, 'http://3.235.67.158:9000', 1, 10)

    print("-" * 10, "加入market client", "-" * 10)
    tx = connector.join_market(role.provider, client_config)
    print(tx['status'])

    print("-" * 10, "获取价格最低client", "-" * 10)
    result = connector.getLowestN()
    print(result)


task_id = 1273184


def post_task():
    print("-" * 10, "推送task", "-" * 10)
    tx = connector.post_task(role.provider, task_id)
    print(tx['status'])


def get_task():
    print("-" * 10, "获取task & client", "-" * 10)
    result = connector.get_task(task_id)
    print(result)


def dispatch_task():
    print("-" * 10, "分配机器", "-" * 10)
    tx = connector.dispatchTaskToClient(role.provider, task_id)
    print(tx['status'])


def submit_task():
    print("-" * 10, "提交任务", "-" * 10)
    tx = connector.submit_task(role.provider, task_id)
    print(tx['status'])
    print(tx)

def get_client_config():
    print("-" * 10, "获取client配置", "-" * 10)
    task, _ = connector.get_task(task_id)
    result = connector.getProverConfig(task[3], task[1])
    print(result)


def auto_init():
    client_config = gen_client_config(env['PROVER_PUBLIC_KEY'], int(env['CLIENT_ID']), env['CLIENT_URL'], int(env['MAX_ZKEVM_INSTANCE']), int(env['MIN_FEE']))
    print(client_config)
    print("-" * 10, "加入market client", "-" * 10)
    tx = connector.join_market(type("owner", (), dict(public_key=env['PROVER_PUBLIC_KEY'], private_key=env['PROVER_PRIVATE_KEY'])), client_config)
    if tx['status'] != 1:
        print("Join Market Failed")
    else:
        print("Join Market Success")


if __name__ == '__main__':
    # auto_init()
    # print(connector.market_dispatch(role.provider, '0x0000000000000000000000000000000000000000', 0)['status'])
    # create_client()
    # creat_client_2()
    # print(connector.market_dispatch(role.provider, '0xC2600C80Beb521CC4E2f1b40B9D169c46E391390', 170073054677)['status'])
    # print(connector.getLowestN())
    # print(connector.has_resource())
    # post_task()
    # dispatch_task()
    # submit_task()
    # v = connector.get_task_by_index(43)
    # print(v)
    for index, i in enumerate(range(100000)):
        try:
            v = connector.get_task_by_index(i)
            print(index, ":", v[2], v[1], v[6])
        except:
            break
    # print(connector.getLowestN())
    # get_task()
    # dispatch_task()
    # get_task()
    # get_client_config()
    # submit_task()
    # get_task()
